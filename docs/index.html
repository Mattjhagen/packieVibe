<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GPT GitHub Dashboard</title>

    <!-- PWA Meta Tags for iOS -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="PacMac" />
    <link rel="apple-touch-icon" href="/assets/icon-192.png" />
    <link rel="apple-touch-startup-image" href="/assets/splash.png">
  </head>

  <body>
    <!-- User Prompt and Generate Button -->
    <textarea id="prompt" placeholder="Describe your app idea..."></textarea>
    <button id="generateAppBtn">Generate App</button>
    <div id="output"></div>

    <!-- Animated Loader -->
    <div id="loader">
      <img src="/assets/icon-192.png" alt="Loading..." class="pulse">
    </div>

    <style>
      #loader {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: #000;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }

      .pulse {
        width: 100px;
        animation: pulse 1.5s infinite;
      }

      @keyframes pulse {
        0%   { transform: scale(1);   opacity: 0.6; }
        50%  { transform: scale(1.2); opacity: 1;   }
        100% { transform: scale(1);   opacity: 0.6; }
      }
    </style>

    <!-- Hide Loader When Page is Ready -->
    <script>
      window.addEventListener("load", () => {
        document.getElementById("loader").style.display = "none";
      });
    </script>

    <!-- Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => {
            console.log('‚úÖ Service worker registered');

            reg.onupdatefound = () => {
              const newWorker = reg.installing;
              newWorker.onstatechange = () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  alert("üöÄ Update Available! Refresh to see the latest version.");
                }
              };
            };
          })
          .catch(err => console.warn('‚ùå Service Worker registration failed:', err));
      }
    </script>

    <!-- PWA Install Prompt Capture -->
    <script>
      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        console.log("üì≤ Install prompt captured");
      });
    </script>

    <!-- Mobile Install Tip for iOS -->
    <script>
      if (window.matchMedia('(display-mode: browser)').matches && /iPhone|iPad/.test(navigator.userAgent)) {
        alert("üöÄ To install VibeCode, tap the Share icon and choose 'Add to Home Screen'");
      }
    </script>

    <!-- Prompt-to-App Generator Logic -->
    <script>
      document.getElementById("generateAppBtn").addEventListener("click", () => {
        const prompt = document.getElementById("prompt").value.trim();

        if (!prompt) {
          document.getElementById("output").innerHTML = "‚ùó Please enter an idea first.";
          return;
        }

        document.getElementById("output").innerHTML = `üöÄ Generating app for: "<strong>${prompt}</strong>"`;

        fetch("https://packiepresents.onrender.com/generate", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ prompt: prompt })
        })
        .then(res => res.json())
        .then(data => {
          document.getElementById("output").innerHTML = data.html || "‚úÖ App generated!";
        })
        .catch(err => {
          console.error(err);
          document.getElementById("output").innerHTML = "‚ùå Error generating app.";
        });
      });
    </script>

    <!-- Other Scripts -->
    <script src="aboutme.js"></script>
    
  </body>
</html>
